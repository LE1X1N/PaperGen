version: '3'

services:
  papergen-figure-service: 
    build: ../services/figure_service
    image: papergen-figure-nightly-build:latest
    container_name: papergen-figure-service
    env_file: .env
    environment:
      - IMAGE_HOST_NAME=papergen-figure-service
    volumes:
      - ../services/figure_service:/app       # 代码挂载
    entrypoint: /bin/bash
    tty: true
    networks:
      - papergen
    ports:
      - ${SVR_HTTP_PORT}:8686
    depends_on:
      - mongodb
      - selenium

  selenium:
    image: selenium/standalone-chrome:latest
    container_name: papergen-selenium
    env_file: .env
    shm_size: 4g
    networks:
      - papergen
    environment:
      - SE_NODE_MAX_SESSIONS=${SELENIUM_MAX_SESSIONS}
      - SE_NODE_SESSION_TIMEOUT=${SELENIUM_SESSION_TIMEOUT}
      - JAVA_OPTS=-Dotel.traces.exporter=none -Dotel.metrics.exporter=none -Dotel.logs.exporter=none

  mongodb:
    image: mongo:7.0.12
    container_name: papergen-mongodb
    env_file: .env
    environment:
      - MONGO_INITDB_ROOT_USERNAME=${MONGODB_USER}
      - MONGO_INITDB_ROOT_PASSWORD=${MONGODB_PASSWORD}
    volumes: 
      - mongodb_data:/data/db
    networks:
      - papergen
    ports:
      - ${MONGODB_PORT}:27017

  minio:
    image: minio/minio:RELEASE.2025-09-07T16-13-09Z
    container_name: papergen-minio
    command: server --console-address ":9001" /data
    env_file: .env
    ports:
      - ${MINIO_PORT}:9000
      - ${MINIO_CONSOLE_PORT}:9001
    environment:
      - MINIO_ROOT_USER=${MINIO_USER}
      - MINIO_ROOT_PASSWORD=${MINIO_PASSWORD}
      - TZ=${TIMEZONE}
    volumes:
      - minio_data:/data
    networks:
      - papergen

volumes:
  mongodb_data:
    driver: local
  minio_data:
    driver: local

networks:
  papergen:
    driver: bridge